---
title: 读书笔记 | 操作系统概念 - 概述部分
date: 2018-03-13 21:02:00
tags: ["读书笔记", "操作系统"]
categories: "Book"
---

大二下学期课程，记录一下学习的重点和笔记 🍗

这一部分只是简单地介绍一些基础的概念，形成一个大概的框架。那些比较深入和复杂的操作下一部分再详述啦。😀

<!--more-->

# 读书笔记 | 操作系统概念

这本书主要介绍关于操作系统的八个部分：操作系统的主要部件， 基本的计算机组成结构， 进程管理， 内存管理， 储存管理， 保护与安全， 分布式及系统， 专用系统。

## 第一章 - 导论

操作系统是管理计算机硬件的程序， 为应用程序提供基础， 并且充当计算机硬件和计算机用户的中介。

计算机系统大致分为4个部分：

- 计算机硬件
- 操作系统
- 系统程序与应用程序
- 用户

### 计算机系统操作

计算机开始运行的时候，通常需要运行一个初始化程序/引导程序(bootstrap program)，通常位于ROM或EEPROM中，称为计算机硬件中的固件。

它负责初始化系统中的所有部分，包括：CPU寄存器， 设备控制器， 内存内容。它必须知道如果装入系统并开始执行系统，定位操作系统内核并把他装入内存，然后操作系统就开始初始化。



### 中断

事件的发生通常通过硬件或软件中断(interrupt)来表示，硬件可以随时通过系统总线向CPU发出信号，触发中断，而软件通过执行特别操作如系统调用(system call)/监视器调用(monitor call)

中断是计算机结构的重要组成部分。中断必须将控制转移到合适的中断处理程序，简单的方法就是调用一个通用的子程序检查中断信息，然后调用对应的中断处理程序。

也可以使用中断处理子程序的指针表，间接地调用，这样就不需要经过其他的中间子程序。通常指针表处于低地址内存，包括了各种设备的中断处理子程序的地址，地址的数组或中断向量(interrupt vector)可以通过唯一设备索引号来提供子程序地址。

中断程序必须负责恢复中断前的状态。

### 储存结构

典型指令执行周期

- 从内存中获取指令， 保存在指令寄存器(instruction register)
- 指令被解码，并可能导致从内存获取操作数或将操作数保存在内部寄存器中
- 执行指令

理想情况下， 程序和数据都永久留在内存中，但是这是不可能的，因为

- 内存太小
- 内存是易失性存储设备

所以需要辅存(secondary storage)， 如磁盘(magnetic disk)， SSD

存储设备层次：(估计比较老的了)

- 寄存器
- 高速缓存
- 主存
- 电子磁盘
- 磁盘
- 光盘
- 磁带



### I/O结构

通用计算机系统由一个CPU和多个设备控制器组成。通过共同的总线连接起来，每个设备控制器负责特定类型的设备，可有多个设备与其相连。

SCSI(small computer system interface)控制器可以有7个或更多的设备相连。

设备控制器

- 维护一定量的本地缓冲存储和一组特定用途的寄存器
- 复制在其控制的外部设备与本地缓冲存储之间进行数据传递
- 通常每个设备控制器都有一个设备驱动程序

I/O中断驱动(适合少量的数据)

- 设备驱动程序在设备控制器中装载适当的寄存器
- 设备控制器检查寄存器状态决定操作
- 控制器开始向本地缓冲区传输数据
- 设备控制器通过中断通知设备驱动程序已完成操作
- 设备驱动程序返回对系统的控制。

DMA(direct memory access)直接内存访问

设备直接写入内存而不需要CPU的干预，每一块只产生一个中断。

交换使得各个部件并发对话而不是在总线上争夺事件，更加地高效



### 计算机系统体系结构

- 单处理器系统

  - 只有一个通用CPU
  - 还包含其他特定目的得微处理器， 用来克服主CPU超载问题

- 多处理器系统(并行系统 Parallel system, 紧耦合系统 tightly coupled system)

  - 拥有多个紧密通信的CPU，共享计算机总线，时钟，内存和外设

  优点：

  - 增加吞吐量
  - 规模经济
  - 增加可靠性

计算机系统不断增加的可靠性是很关键的，这种能提供与正常工作的硬件成正比的服务的能力称为**适度退化**(graceful degradation)。超出适度退化的能力被称为容错(fault tolerant)

多处理器系统主要分为 

非对称多处理(asymmetric multiprocessing) ： 主从处理器

对称多处理(symmetric multiprocessing， SMP)

概念： 刀片服务器(blade server) 每个刀片处理器独立启动并运行各自的系统

- 集群系统

由两个或多个独立的系统耦合起来的

通过局域网连接或更快的内部连接(InfiniBand)

用途： 提供高可用性(high availability)服务

分类：对称与非对称

非对称集群(asymmetric clustering)中， 一台机器处于热备份状态(hot standby mode)，另一台运行程序。

对称集群(symmetric clustering)，两个或多个主机都运行程序并互相监视。

还有并行集群和WAN集群。

并行集群中通常需要分布式锁管理器(distributed lock manager， DLM)

​	

### 操作系统结构

分时操作系统、多道程序设计

进程(process):装到内存并执行的程序

作业调度(job scheduling)： 在储存在磁盘作业池(job pool)中与主存中的作业做出决策和安排

CPU调度(CPU scheduling)： 多个任务同时执行

在分时操作系统中，为了保证合理的相应时间，就需要通过交换来得到。通常使用虚拟内存(virtual memory)实现。



### 操作系统操作

现代操作系统通常是由**中断**驱动的。

操作系统的合理设计必须确保错误程序(或恶意程序)不会造成其他程序执行错误。

#### 双重模式操作

区分操作系统代码和用户自定义代码的执行，通常提供硬件支持以允许区分各种执行模式(在计算机硬件增加一个模式位(mode bit)来区分)

- 用户模式(user mode)
- 内核模式：监督程序模式(monitor mode)[也称为管理模式(supervisor mode)]、系统模式(system mode)或特权模式(privileged mode)

只要操作系统获得了对计算机的控制，就处于内核模式。

某些特权指令(privileged instruction)只能在内核模式执行。

特权指令：可以引起损害的机器指令，如切换到用户模式、I/O的控制、定时器的管理和中断管理

系统调用通常采用陷阱到中断向量中的一个指定位置的方式。

#### 定时器

确保操作系统维持对CPU的控制，防止用户程序陷入死循环不返回控制权，通常使用定时器(timer)定时中断。



### 进程管理

进程：处于执行中的程序

需要一定的资源

程序本身不是进程，程序时被动的实体。

单线程进程具有一个**程序计数器**来明确下一个执行的指令，这样程序的执行必须时连续的。

进程时系统工作的单元。系统由多个进程组成，其中一些事操作系统进程，其他是用户进程。

操作系统需要负责：

- 创建和删除用户进程和系统进程
- 挂起和重启进程
- 提供进程同步机制
- 提供进程通讯机制
- 提供死锁处理机制

### 内存管理

内存是现代计算机操作系统的中心，是CPU和I/O设备共同快速访问的数据仓库，通常也是CPU可以直接寻址和访问的唯一大容量存储器。

操作系统负责下列有关的内存管理的活动：

- 记录内存的哪部分正在被使用和被谁使用
- 当有内存空间是，决定哪些进程可以装入内存
- 根据需要分配和释放内存空间

### 存储管理

#### 文件系统管理

操作系统负责：

- 创建和删除文件
- 创建和删除目录来组织文件
- 提供操作文件和目录的原语
- 将文件映射到二级存储上
- 在稳定存储介质上备份文件

#### 大容量存储器管理

操作系统负责：

- 空闲空间管理
- 存储空间分配
- 硬盘调度

#### 高速缓存

由于高速缓存的大小有限，因此高速缓存管理(cache management)的设计就显得十分地重要。

高速缓存的大小和置换策略的仔细选择可以极大地提高性能.

高速缓存需要解决**高速缓存一致性**(cache coherency),这通常是硬件问题。以确保每个进程都得到最近已更新的A值

#### I/O 系统

操作系统的目的之一： 对用户隐藏具体硬件设备的特性。

而I/O子系统也对操作系统隐藏一些I/O设备的特性。只有设备驱动才知道特性。



### 保护和安全

保护： 一种控制进程或用户对计算机系统资源的访问的机制

安全： 防止系统不受外部或内部攻击



### 分布式系统

网络， 两个或多个系统之间的通讯路径

一个网络协议只简单地需要一个接口设备，加上管理他的驱动程序以及按网络协议处理数据的软件

根据**节点间的距离**来分，网络可以分为

- 局域网(local-area network， LAN)
- 广域网(wide-area network， WAN)
- 城域网(metropolitan-area network，MAN)
- 小域网(small-area network， SAN)

网络操作系统(network operating system) 提供了比网络连接更进一步的网络和分布式系统的概念



### 专用系统

- 实时嵌入式系统
- 多媒体系统
- 手持系统

### 计算环境

#### 传统计算

#### 客户机 - 服务器计算

- 计算服务器系统
- 文件服务器系统

#### 对等计算

对等(P2P)系统模式

#### 基于Web的计算





## 第二章 - 操作系统结构

### 操作系统服务

操作系统提供给用户的常用函数：

- 用户界面(user interface, UI)：
  - 命令行界面(command-line interface, CLI)
  - 批界面(batch interface)，不常见
  - 图形用户界面(graphical user interface, GUI)
- 程序执行
- I/O操作
- 文件系统操作
- 通信： 一个进程与另一个进程进行交换信息，可以通过**共享内存**或**信息交换**来实现
- 错误检测

确保系统高效运行的函数：

- 资源分配：
  - 如，CPU周期， 内存，文件储存：需要特别的分配代码
  - 如， I/O设备：只需要通用的请求和释放代码
- 统计(accounting)
- 保护和安全

### 操作系统的用户界面

#### 命令解释程序(Command Interpreters)

获取并执行用户指定的下一条命令

有两种常用的方法:

- 命令解释程序本身包含代码以执行这些命令
- 由系统程序实现绝大多数命令，命令解释程序只需要调用

#### 图形用户界面(Graphical User Interfaces)



### 系统调用(System Calls)

提供了操作系统提供的有效服务界面

常用的API：

- Win32 API
- POSIX API(包括几乎所有UNIX、Linux和Mac OS X)
- Java API

向系统传递参数的方法：

- 通过寄存器
- 存在内存的块或表中
- 放在或压入堆栈中

### 系统调用类型

- 进程控制
  - end, abort
  - load, execute
  - create process, terminate process
  - get process attributes, set process attributes
  - wait for time
  - wait event, signal event
  - allocate and free memory
- 文件管理
  - create file, delete file
  - open, close
  - read, write, reposition(重定位)
  - get file attributes, set file attributes
- 设备管理
  - request device, release device
  - read, write, reposition
  - get device attributes, set device attributes
  - logically attach or detach devices
- 信息维护
  - get time or date, set time or date
  - get system data, set system data
  - get process, file, or device attributes
  - set process, file, or device attributes


- 通信
  - create, delete communication connection
  - send, receive message
  - transfer status information
  - attach or detach remote devices

#### 进程控制

- 运行程序需要能正常或非正常地中断其执行(end 或 abort)
- 当发生错误的时候，就会由内存信息转储(dump of memory)并产生一个错误信息
- 装入和执行另一个程序
- 如果新程序终止时控制权返回到现有程序，那么需要保存现有程序的内存映像
- 创建新的作业或线程，需要可以控制他的执行，能决定和重置进程或作业的属性(优先级、最大允许执行时间)
- 等待作业或进程执行
- 提供转储内存信息的系统调用，帮助调试
- 提供程序的时间表
- 单任务与多任务系统的控制



#### 设备管理

I/O设备和文件非常相似，在UNIX中将这两者合并为**文件-设备结构**



#### 通讯

通讯模型：

- 消息传递模型(message-passing model)
- 共享内存模型(shared-memory model)



### 系统程序

可以分为：

- 文件管理
- 状态信息
- 文件修改
- 程序语言支持
- 程序装入和执行
- 通讯

还有一些系统工具和应用程序



### 操作系统设计和实现

#### 设计目标

定义系统的目标和规格

系统类型：批处理、 分时、 单用户、 多用户、 分布式、 实时、 通用目标

两个基本类： 用户目标和系统目标

#### 机制（mechanism）和策略（policy）

机制决定如何做， 策略决定做什么

#### 实现

现代操作系统一般都是用高级语言编写， 如C或C++

代码编写更快， 更为紧凑，容易理解和调试。

缺点仅仅为降低了速度和增加了存储要求



### 操作系统结构

#### 简单结构

MS-DOS：并没有很好区分接口和功能层次，应用程序可以直接访问基本的I/O。

UNIX： 由内核和系统程序组成， 物理硬件之上和系统调用接口之下的所有部分都是内核， 这一单一的结构使UNIX难以增强

#### 分层方法

采用自顶向下方法，可先确定总的功能和特征，再划分模块

使用分层法来模块化，最底层(层0)是硬件层，最高层(层N)为用户接口

主要优点： 构造和调试的简单化，每层只能调用较低层的功能和服务。

主要困难：对层的详细定义较难， 效率稍差。

#### 微内核

将非基本部分从内核移走

微内核通常包括最小的进程和内存管理以及通讯功能。

好处：便于扩充操作系统

缺点：由于系统功能总开销的增加而导致系统性能的下降

#### 模块

Solaris系统：

- 核心内核
  - 调度类
  - 文件系统
  - 可加载的系统调用
  - 可执行格式
  - STREAMS模块
  - 杂项模块
  - 设备和总线驱动

Mac OS X， 混合结构：

- 程序-》BSD-》Mach
- 程序-》Mach

#### 虚拟机

提供与基本硬件相同的接口

虚拟用户模式和虚拟内核模式运行在物理用户模式

优点：

- 不同的系统资源具有完全的保护
  - 可以通过共享磁盘或虚拟机网络通讯
- 研究和开发操作系统

实例

- VMware
  - 将Intel 80x86硬件抽象为独立的虚拟机
- Java 虚拟机（JVM）
  - **类加载器** ： 从Java程序和Java API中加载编译过的.class文件 
  - 执行与平台无关的字节码Java解释器
  - JIT(just-in-time)，可以在第一次调用Java方法时，转换为本地机器语言，加快运行速度。
- CLR（.Net的核心，公共语言运行时）

### 系统生成

System generation， SYSGEN

配置和生成系统

需要确定的信息：

- CPU
- 内存
- 可用设备及其具体调用信息
- 系统选项的参数

生成方法（区别在于大小和通用性，以及硬件变化进行修改的方便性）：

- 系修改源代码，重新编译
- 从预先编译的库中选择模块，将表格连接起来形成操作系统
- 由表驱动，在运行时选择适当的模块（大多数现代操作系统）

### 系统启动

#### 过程

- 加电
- 运行初始化程序(或引导程序，在ROM中)
  - 初始化CPU寄存器，设备控制器到内存
- 引导程序装入操作系统内核到内存
- 操作系统执行第一个进程init，并等待某些事件发生
- 若事件发生，则进入该事件处理程序

个人计算机中：一个简单的引导程序从磁盘调用一个较复杂的引导程序，再装入内核

CPU重置：从ROM中，指令寄存器被重新加载，并开始执行。（此时RAM处于未知状态）

有些系统在ROM中保存完整的操作系统



## 结语

以上就是一些操作系统的基础知识。接下来一部分要深入到进程慢慢探究了，有点深奥，慢慢来，慢慢来。😪
